<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GoogIe Pay</title>
  <style>
    :root{
      --bg:#f8fafc;
      --card:#ffffff;
      --muted:#64748b;
      --text:#1e293b;
      --brand:#2563eb;
      --chip:#e2e8f0;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Arial, Helvetica, sans-serif;
      background:var(--bg);
      display:flex;
      justify-content:center;
      color:#334155;
    }
    .container{
      width:100%;
      max-width:480px;
      min-height:100vh;
      background:var(--bg);
      padding:10px;
    }

    /* Top */
    .topbar{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
    }
    .searchbar{
      flex:1;
      display:flex;
      align-items:center;
      gap:8px;
      background:#fff;
      border-radius:25px;
      padding:0 15px;
      box-shadow:0 1px 3px rgba(0,0,0,.08);
      font-size:14px;
      color:#475569;
      min-height:40px;
    }

    .searchbar input{
      border:none;
      outline:none;
      flex:1;
      font-size:14px;
      color:#475569;
      background:transparent;
    }
    .avatar{
      width:36px;height:36px;border-radius:50%;
      background:#ddd;flex-shrink:0;
    }

    /* Banner */
    .banner{
      margin-top:15px;
      background:url('Img/loan bg 1.jpg');
      border-radius:15px;
      background-size: 100%;
      padding:45px;
      display:flex;justify-content:space-between;align-items:center;
    }
    .banner button{
      margin-top:8px;padding:6px 14px;border:none;border-radius:18px;
      background:var(--brand);color:#fff;font-size:13px;cursor:pointer;
    }

    /* Quick actions */
    .quick-actions{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
      gap:10px;margin-top:15px;text-align:center;
    }
    .quick-actions .item{
      display:flex;flex-direction:column;align-items:center;font-size:12px;
    }
    .icon{
      width:50px;height:50px;border-radius:15px;background:#d4e4fc;
      display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:6px;
    }

    /* UPI strip */
    .upi-section{
      margin-top:15px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      scrollbar-width: none; /* Firefox */
    }
    .upi-section::-webkit-scrollbar {
      display: none; /* Chrome/Safari/Webkit */
    }
   .chip{
      background:#fff;border-radius:12px;padding:10px 15px;
      justify-content:space-between;align-items:center;font-size:14px;margin-bottom:10px;gap:10px;
      flex: 0 0 auto;
      width: 90%; /* Make chips take full width when not scrollable */
    }
    .chip.dashed{border:2px dashed #cbd5e1}
    .chip .btn{
      border:none;background:var(--chip);padding:6px 12px;border-radius:18px;font-size:12px;cursor:pointer;
    }
    /* People */
    .people{margin-top:20px}
    .people h3{margin:0 0 10px;font-size:14px;font-weight:700}
    .people-list{display:flex;gap:15px;overflow-x:auto}
    .people-list::-webkit-scrollbar{display:none}
    .person{display:flex;flex-direction:column;align-items:center;font-size:12px}
    .person .avatar{width:48px;height:48px;margin-bottom:5px}

    /* Generic section */
    .section{margin-top:25px}
    .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .section-header h3{margin:0;font-size:22px;line-height:1.2;color:#0f172a;font-weight:700}
    .section-header a{font-size:13px;color:var(--brand);text-decoration:none}
    .subtext{font-size:12px;color:var(--muted);margin-bottom:15px}

    /* Bills grid */
    .grid-icons{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:18px;text-align:center}
    .grid-icons .cell{display:flex;flex-direction:column;align-items:center;font-size:14px}
    .grid-icons .circle{
      width:64px;height:64px;border-radius:50%;background:#e2e8f0;
      display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:8px;
    }

    /* Businesses carousel */
    .business-list{display:flex;gap:15px;overflow-x:auto}
    .business-list::-webkit-scrollbar{display:none}
    .business-item{min-width:74px;display:flex;flex-direction:column;align-items:center;font-size:12px}
    .business-logo{width:56px;height:56px;border-radius:50%;background:#ddd;margin-bottom:6px}

    /* Cards */
    .card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-top:10px}
    .card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);font-size:13px}
    .card h4{margin:6px 0;font-size:15px;color:#0f172a}
    .card p{margin:0;font-size:12px;color:var(--muted)}

    /* Offers & rewards (colored circles) */
    .offers-wrap{margin-top:25px}
    .offer-circles{display:flex;gap:18px;overflow-x:auto}
    .offer-circles::-webkit-scrollbar{display:none}
    .round{min-width:72px;text-align:center}
    .round .pill{
      width:60px;height:60px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;margin:0 auto 6px;
      font-size:20px;
    }
    .c1{background:linear-gradient(135deg,#f59e0b,#d97706)}
    .c2{background:linear-gradient(135deg,#ef4444,#b91c1c)}
    .c3{background:linear-gradient(135deg,#3b82f6,#1d4ed8)}
    .c4{background:linear-gradient(135deg,#0ea5e9,#0369a1)}

    /* Invite / referral card */
    .referral-card{
      margin-top:14px;background:#eef4ff;border-radius:14px;padding:14px;
      display:flex;justify-content:space-between;align-items:center;gap:12px
    }
    .referral-card strong{font-size:16px;color:#0f172a}
    .referral-cta{color:var(--brand);font-weight:700;text-decoration:none;margin-top:6px;display:inline-block}

    /* Manage your money list */
    .money{margin-top:24px}
    .money-list{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .money-item{
      display:flex;justify-content:space-between;align-items:center;gap:12px;
      padding:14px 12px;border-bottom:1px solid #eef2f7;font-size:14px
    }
    .money-item:last-child{border-bottom:none}
    .money-item .title{font-weight:700;color:#0f172a}
    .money-item small{display:block;color:var(--muted);font-size:12px;font-weight:400}
    .money-item .link{color:var(--brand);font-weight:700;text-decoration:none;font-size:13px}
    .chev{font-size:18px;opacity:.45}

    /* Tiny footer hill (purely visual placeholder) */
    .hill{
      margin:26px auto 8px;height:56px;border-radius:24px/56px;
      background:linear-gradient(0deg,#eaf2ff,#f6f9ff 60%, transparent 60%);
      max-width:440px;
    }
  </style>
</head>
<body>
   <div class="container">
    <!-- Top -->
 <div style="background:#f1f6fc;">
    <div class="topbar">
      <div class="searchbar">
            <Img src="Img/search icon.png" style="width:30px;" alt="üîç"></Img>
        <input type="text" placeholder="Pay friends and merchants" />
      </div>
      <div class="avatar"><Img src="Img/me.jpg" style="width:100%; height:100%; border-radius:100%;"></Img></div>
    </div>


    <!-- Banner -->
    <div class="banner">
      <div>
        <div style="font-weight:700;color:#0f172a; margin-top:30px;">Instant loans up to ‚Çπ10 lakh</div>
        <button>Apply now</button>
      </div>
    </div>
</div>

    <!-- Quick actions -->
    <div class="quick-actions">
      <div class="item">
        <button onclick="document.getElementById('qrscan').style.display = 'block'; " style="border:none; padding:0px; background: transparent;"><div class="icon"><Img src="Img/qr.png" style="width:100%; border-radius:15px;" alt="üì∑"></Img></div></button>
        <span>Scan any<br/>QR code</span>
      </div>
      <div class="item">
        <div class="icon"><Img src="Img/pay anyone.png" style="width:100%; border-radius:15px;" alt="üí∏"></Img></div>
        <span>Pay<br/>anyone</span>
      </div>
      <div class="item">
        <div class="icon"><Img src="Img/bank transfer.png" style="width:100%; border-radius:15px;" alt="üè¶"></Img></div>
        <span>Bank<br/>transfer</span>
      </div>
      <div class="item">
        <div class="icon"><Img src="Img/mobile recharge.png" style="width:100%; border-radius:15px;" alt="üîã"></Img></div>
        <span>Mobile<br/>recharge</span>
      </div>
    </div>

    <!-- UPI -->
<div style=" ">
    <div class="upi-section">
      <div class="chip dashed" style="height:58px; width: 60%;"><Img src="Img/upi lite.png" style="width:32px;" alt="+"></Img><p style="margin: -26px 35px;">Activate UPI Lite</p></div>
      <div class="chip" style=" height:58px; width:270px; background:#f0efef; ">
        <div>
          <div style="font-size:10px;text-transform:uppercase;color:var(--muted)">UPI ID</div>
          <div style="font-weight:600">teerthsingh9509@okhdfcbank</div>
        </div>
      </div>
    </div>
</div>

    <!-- People -->
    <div class="people">
      <h3>People</h3>
      <div class="people-list">
        <div class="person"><div class="avatar" style="background:blueviolet; color:#ede8e8; font-size:28px; align-content:center; text-align:center;">P</div><span>Papa</span></div>
        <div class="person"><div class="avatar" style="background:darkslateblue; color:#ede8e8; font-size:28px; align-content:center; text-align:center;">M</div><span>Maa</span></div>
        <div class="person"><div class="avatar" style="background:maroon; color:#ede8e8; font-size:28px; align-content:center; text-align:center;">D</div><span>Dadu</span></div>
        <div class="person"><div class="avatar" style="background:darkgreen;  color:#ede8e8; font-size:28px; align-content:center; text-align:center;">S</div><span>Shivam</span></div>
      </div>
    </div>

    <!-- Bills & recharges -->
    <div class="section">
      <div class="section-header">
        <h3>Bills & recharges</h3>
        <a href="#">Manage ‚ûî</a>
      </div>
      <div class="subtext">Get reminders and pay on time</div>
      <div class="grid-icons">
        <div class="cell"><div class="circle"><Img src="Img/recharge.png" style="width:100%;height:100%; border-radius:100%;" alt="üîã"></Img></div><span>Mobile<br/>recharge</span></div>
        <div class="cell"><div class="circle"><Img src="Img/electricity.png" style="width:100%;height:100%; border-radius:100%;" alt="üí°"></Img></div><span>Electricity</span></div>
        <div class="cell"><div class="circle"><Img src="Img/dth.png" style="width:100%;height:100%; border-radius:100%;" alt="üì∫"></Img></div><span>DTH / Cable TV</span></div>
        <div class="cell"><div class="circle"><Img src="Img/emi.png" style="width:100%; height:100%; border-radius:100%;" alt="üí∞"></Img></div><span>Loan EMI</span></div>
        <div class="cell"><div class="circle"><Img src="Img/fastag.png" style="width:100%;height:100%; border-radius:100%;" alt="üöò"></Img></div><span>FASTag recharge</span></div>
        <div class="cell"><div class="circle"><Img src="Img/credit card.png" style="width:100%;height:100%; border-radius:100%;" alt="üí≥"></Img></div><span>Credit cards</span></div>
        <div class="cell"><div class="circle"><Img src="Img/postpaid.png" style="width:100%; height:100%; border-radius:100%;" alt="üì±"></Img></div><span>Postpaid mobile</span></div>
        <div class="cell"><div class="circle"><Img src="Img/google play.png" style="width:100%; height:100%; border-radius:100%;" alt="‚ñ∂Ô∏è"></Img></div><span>Google Play</span></div>
      </div>
    </div>

    <!-- Businesses -->
    <div class="section">
      <div class="section-header">
        <h3>Businesses</h3>
        <a href="#">Explore ‚ûî</a>
      </div>
      <div class="business-list">
        <div class="business-item"><div class="business-logo" style="background:dodgerblue; color:white; font-size:28px; align-content:center; text-align:center; border:2px dashed #cbd5e1;">S</div><span>SEVEN SP...</span></div>
        <div class="business-item"><div class="business-logo"><Img src="Img/fibe.png" style="width:100%; height:100%; border-radius:100%; border:2px dashed #cbd5e1;"></Img></div><span>Fibe Loans</span></div>
        <div class="business-item"><div class="business-logo"><Img src="Img/payme.png" style="width:100%; height:100%; border-radius:100%; border:2px dashed #cbd5e1;"></Img></div><span>PayMe</span></div>
        <div class="business-item"><div class="business-logo"><Img src="Img/redbus.jpg" style="width:100%; height:100%; border-radius:100%; border:2px dashed #cbd5e1;"></Img></div><span>REDBUS In...</span></div>
      </div>
    </div>

    <!-- Gift cards -->
    <div class="section">
      <div class="section-header"><h3>Gift cards & more</h3></div>
      <div class="card-grid">
        <div class="card">
          <div style="font-size:22px">üé¨</div>
          <h4>Subscriptions</h4>
          <p>Buy plans from leading OTT platforms</p>
        </div>
        <div class="card">
          <div style="font-size:22px">üéÅ</div>
          <h4>Gift cards</h4>
          <p>Buy gift cards from the biggest brands</p>
        </div>
      </div>
    </div>

    <!-- Offers & rewards -->
    <div class="offers-wrap">
      <div class="section-header"><h3>Offers & rewards</h3></div>
      <div class="offer-circles">
        <div class="round"><div class="pill c1"><Img src="Img/rewards.png" style="width:100%;height:100%; border-radius:100%;" alt="üèÜ"></Img></div><div>Rewards</div></div>
        <div class="round"><div class="pill c2"><Img src="Img/offers.png" style="width:100%; height:100%; border-radius:100%;" alt="üè∑Ô∏è"></Img></div><div>Offers</div></div>
        <div class="round"><div class="pill c3"><Img src="Img/refferal.png" style="width:100%; height:100%; border-radius:100%;" alt="üë•"></Img></div><div>Referrals</div></div>
        <div class="round"><div class="pill c4"><Img src="Img/Rupay.png" style="width:100%; height:100%; border-radius:100%;" alt="üõçÔ∏è"></Img></div><div>RuPay Shop</div></div>
      </div>

      <!-- Invite friends card -->
      <div class="referral-card" style="background:url('Img/personal loan.png');">
        <div>
          <div>Invite friends to get <strong>‚Çπ201</strong></div>
          <div style="color:var(--muted);font-size:13px">Referral code: <code>6t4j27t</code></div>
          <a class="referral-cta" href="#">Invite & earn</a>
        </div>
        <div style="width:70px;height:56px;background:#dbeafe;border-radius:10px;"></div>
      </div>
    </div>

    <!-- Manage your money -->
    <div class="money">
      <div class="section-header"><h3>Manage your money</h3></div>
      <div class="money-list">
        <div class="money-item">
          <div>
            <div class="title"><Img src="Img/personal loan.png" style="width:35px;position:relative; margin: -20px auto; border-radius:15px;"></Img>Personal loan</div>
            <small style="margin-left:35px;">Up to ‚Çπ10 lakh, instant approval</small>
          </div>
          <a class="link" href="#">Apply now</a>
        </div>
        <div class="money-item">
          <div class="title"><Img src="Img/cibil.png" style="width:35px;position:relative; margin: -12px auto; border-radius:15px;"></Img>Check your CIBIL score for free</div>
          <span class="chev">‚Ä∫</span>
        </div>
        <div class="money-item">
          <div class="title"><Img src="Img/transaction.png" style="width:35px;position:relative; margin: -12px auto; border-radius:15px;"></Img>See transaction history</div>
          <span class="chev">‚Ä∫</span>
        </div>
        <div class="money-item">
          <div class="title"><Img src="Img/bank transfer.png" style="width:35px;position:relative; margin: -12px auto; border-radius:15px;"></Img>Check bank balance</div>
          <span class="chev">‚Ä∫</span>
        </div>
      </div>
    </div>

    <div class="hill"></div>
  </div>

<iframe id="qrscan" srcdoc='
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QR Scanner ‚Äî precise overlay (with switch camera)</title>
<style>
  :root{ --overlay-alpha:.62; --corner-color-size:56px }
  *{box-sizing:border-box}
  html,body{width:100%;height:100%;margin:0;background:#000}
  .scanner-container{
    position:relative;
    width:100%;
    height:100vh;
    overflow:hidden;
    font-family: sans-serif;
    -webkit-font-smoothing:antialiased;
  }

  /* camera */
  #camera{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover;
    z-index:0;
    background:#000;
  }

  /* SVG overlay (mask) */
  svg#overlay {
    position:absolute; inset:0; width:100%; height:100%;
    z-index:5;
    pointer-events:none;
  }

  /* scanner frame */
  .scanner-frame{
    position:absolute;
    left:50%; top:48%;
    transform:translate(-50%,-50%);
    width: min(420px, 74vw);
    aspect-ratio:1/1;
    z-index:10;
    --corner-size:56px;
  }

  /* corner arcs */
  .corner {
    position:absolute;
    width:var(--corner-size);
    height:var(--corner-size);
    border-radius:25%;
    z-index:15;
  }
  .corner.tl { top: calc(var(--corner-size) * -0.38); left: calc(var(--corner-size) * -0.38);
    border-left: calc(var(--corner-size) * 0.14) solid #ff7b7b;
    border-top:  calc(var(--corner-size) * 0.14) solid #ff7b7b;
    border-right: none; border-bottom: none; border-radius: 25% 10% 0% 10%;
  }
  .corner.tr { top: calc(var(--corner-size) * -0.38); right: calc(var(--corner-size) * -0.38);
    border-right: calc(var(--corner-size) * 0.14) solid #ffb547;
    border-top:   calc(var(--corner-size) * 0.14) solid #ffb547;
    border-left: none; border-bottom: none; border-radius: 10% 25% 10% 0%;
  }
  .corner.bl { bottom: calc(var(--corner-size) * -0.38); left: calc(var(--corner-size) * -0.38);
    border-left: calc(var(--corner-size) * 0.14) solid #5aa0ff;
    border-bottom: calc(var(--corner-size) * 0.14) solid #5aa0ff;
    border-top:none;border-right:none; border-radius: 10% 0% 10% 25%;
  }
  .corner.br { bottom: calc(var(--corner-size) * -0.38); right: calc(var(--corner-size) * -0.38);
    border-right: calc(var(--corner-size) * 0.14) solid #34c759;
    border-bottom: calc(var(--corner-size) * 0.14) solid #34c759;
    border-top:none;border-left:none; border-radius: 0% 10% 25% 10%;
  }

  /* top controls */
  .top-controls{
    position:absolute;
    top:10px; left:12px; right:12px;
    display:flex; justify-content:space-between; align-items:center;
    z-index:20; color:#fff; font-size:18px;
    pointer-events:auto;
  }
  .btn { cursor:pointer; padding:6px; border-radius:6px; color:#fff; }
  .btn:hover { background: rgba(255,255,255,0.12); }

  /* right controls group */
  .right-controls { display:flex; gap:10px; align-items:center; }

  /* upload button */
  .upload-btn{
    position:absolute;
    left:50%;
    top: calc(50% + min(420px, 74vw) / 2 + 28px);
    transform:translateX(-50%);
    z-index:20;
    display:inline-flex; gap:10px; align-items:center;
    padding:10px 18px;
    background:#fff; color:#111;
    border-radius:26px;
    box-shadow:0 6px 14px rgba(0,0,0,0.35);
    font-size:15px; cursor:pointer;
  }

  /* bottom sheet */
  .bottom-sheet{
    position:absolute; left:0; right:0; bottom:10px;
    z-index:20;
    display:flex; justify-content:center; flex-direction:column; align-items:center;
    color:#fff; text-align:center; font-size:16px;
  }
  .bottom-sheet small{font-size:13px; color:rgba(255,255,255,0.85); margin-top:6px;}

  @media (max-width:420px){
    .scanner-frame{ width:74vw; }
  }
</style>
</head>
<body>
  <div class="scanner-container">

    <!-- Camera -->
    <video id="camera" autoplay playsinline></video>

    <!-- Overlay -->
    <svg id="overlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000" preserveAspectRatio="none">
      <defs>
        <mask id="maskHole">
          <rect x="0" y="0" width="100%" height="100%" fill="white"/>
          <rect id="hole" x="0" y="0" width="0" height="0" rx="24" ry="24" fill="black"/>
        </mask>
      </defs>
      <rect x="0" y="0" width="100%" height="100%" fill="rgba(0,0,0,0.62)" mask="url(#maskHole)"/>
    </svg>

    <!-- Frame -->
    <div class="scanner-frame" id="frame">
      <span class="corner tl"></span>
      <span class="corner tr"></span>
      <span class="corner bl"></span>
      <span class="corner br"></span>
    </div>

    <!-- Controls: left close, right flash/switch/menu -->
    <div class="top-controls">
      <div class="left-controls">
        <div class="btn" id="closeBtn">‚úï</div>
      </div>

      <div class="right-controls">
        <div class="btn" id="flashBtn" title="Toggle flashlight">üî¶</div>
        <div class="btn" id="switchBtn" title="Switch camera">üîÅ</div>
        <div class="btn" id="menuBtn" title="More">‚ãÆ</div>
      </div>
    </div>

    <!-- Upload -->
    <label class="upload-btn" id="uploadBtn">üñº Upload from gallery
      <input id="fileInput" type="file" accept="image/*" style="display:none">
    </label>

    <!-- Bottom sheet -->
    <div class="bottom-sheet">
      <div>Scan any QR code to pay</div>
      <small>Google Pay ‚Ä¢ PhonePe ‚Ä¢ PayTM ‚Ä¢ UPI</small>
    </div>
  </div>

<!-- jsQR -->
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script>
(async function(){
  const video = document.getElementById("camera");
  const frame = document.getElementById("frame");
  const hole = document.getElementById("hole");
  const overlaySvg = document.getElementById("overlay");
  const flashBtn = document.getElementById("flashBtn");
  const closeBtn = document.getElementById("closeBtn");
  const switchBtn = document.getElementById("switchBtn");
  const menuBtn = document.getElementById("menuBtn");
  const fileInput = document.getElementById("fileInput");
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  let stream = null;
  let videoTrack = null;
  let usingTorch = false;
  let scanning = false;
  // current facing mode: "environment" (rear) or "user" (front)
  let currentFacing = "environment";

  // --- helpers ---
  function stopCamera() {
    scanning = false;
    if (stream) {
      stream.getTracks().forEach(t => t.stop());
      stream = null;
      videoTrack = null;
    }
  }

  async function startCamera(facingMode = currentFacing){
    // stop old first
    stopCamera();
    try{
      // use "ideal" so if requested camera not available it falls back
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { ideal: facingMode }, width:{ideal:1280}, height:{ideal:720} },
        audio: false
      });
      video.srcObject = stream;
      videoTrack = stream.getVideoTracks()[0];

      // wait until playing, then set mask and start scanning
      video.onloadedmetadata = () => {
        // small delay to let layout settle and metadata apply
        setTimeout(()=> {
          updateMask();
          startScanning();
        }, 120);
      };
      // ensure playsinline + play
      try { await video.play(); } catch(e){ /* autoplay blocked? */ }
    }catch(err){
      console.error("camera start failed", err);
      alert("Unable to access camera. Use HTTPS and allow camera permission.");
    }
  }

  // maps the frame DOM rect into the SVG viewBox coordinates
  function updateMask(){
    const rect = frame.getBoundingClientRect();
    const svgRect = overlaySvg.getBoundingClientRect();
    const viewW = 1000, viewH = 1000;
    const x = ((rect.left - svgRect.left)/svgRect.width)*viewW;
    const y = ((rect.top - svgRect.top)/svgRect.height)*viewH;
    const w = (rect.width/svgRect.width)*viewW;
    const h = (rect.height/svgRect.height)*viewH;
    hole.setAttribute("x", x);
    hole.setAttribute("y", y);
    hole.setAttribute("width", w);
    hole.setAttribute("height", h);
    hole.setAttribute("rx", Math.max(12, w * 0.06));
    hole.setAttribute("ry", Math.max(12, h * 0.06));

    // scale corner size variable
    const cornerSize = Math.max(36, Math.round(rect.width * 0.14));
    frame.style.setProperty("--corner-size", cornerSize + "px");
  }

  // scanning loop
  function startScanning(){
    if (scanning) return;
    scanning = true;
    requestAnimationFrame(scanLoop);
  }

  function scanLoop(){
    if (!scanning) return;
    if (video.readyState === video.HAVE_ENOUGH_DATA){
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const ImgData = ctx.getImageData(0,0,canvas.width,canvas.height);
      const code = jsQR(ImgData.data, ImgData.width, ImgData.height, { inversionAttempts: "dontInvert" });
      if (code){
        scanning = false;
        // stop camera tracks
        if (stream) stream.getTracks().forEach(t => t.stop());
        // result action (you can replace with open/copy behavior)
        alert("QR Code detected:\n" + code.data);
        return;
      }
    }
    requestAnimationFrame(scanLoop);
  }

  // flashlight toggle
  flashBtn.addEventListener("click", async () => {
    if (!videoTrack) { alert("Camera not ready"); return; }
    const caps = videoTrack.getCapabilities ? videoTrack.getCapabilities() : {};
    if (!caps.torch) { alert("Torch not supported on this device/browser."); return; }
    try {
      usingTorch = !usingTorch;
      await videoTrack.applyConstraints({ advanced: [{ torch: usingTorch }] });
      // visual feedback (could toggle icon)
      flashBtn.style.opacity = usingTorch ? "0.8" : "1";
    } catch (err) {
      console.error("Torch error", err);
      alert("Could not toggle flashlight.");
    }
  });

  // switch camera
  switchBtn.addEventListener("click", async () => {
    // toggle choice and start camera with new facing
    currentFacing = currentFacing === "environment" ? "user" : "environment";
    // small UI feedback
    switchBtn.textContent = currentFacing === "environment" ? "üîÅ" : "üîÅ";
    await startCamera(currentFacing);
  });

  // menu placeholder
  menuBtn.addEventListener("click", ()=> {
    alert("Menu clicked ‚Äî implement actions here.");
  });

  // close
  closeBtn.addEventListener("click", ()=> {
    stopCamera();
    // if embedded in parent iframe and you want to hide parent element
    try { window.parent.document.getElementById("qrscan").style.display = "none"; } catch(e){}
  });

  // handle upload from gallery, scan that image
  document.getElementById("uploadBtn").addEventListener("click", ()=> fileInput.click());
  fileInput.addEventListener("change", (e)=> {
    if (!e.target.files || !e.target.files[0]) return;
    const file = e.target.files[0];
    const Img = new Image();
    Img.onload = () => {
      canvas.width = Img.width; canvas.height = Img.height;
      ctx.drawImage(Img, 0, 0);
      const ImgData = ctx.getImageData(0,0,canvas.width,canvas.height);
      const code = jsQR(ImgData.data, ImgData.width, ImgData.height, { inversionAttempts: "dontInvert" });
      if (code) alert("QR from image:\n" + code.data);
      else alert("No QR found in image.");
    };
    Img.src = URL.createObjectURL(file);
  });

  // responsive updates
  window.addEventListener("resize", () => setTimeout(updateMask, 120));
  window.addEventListener("orientationchange", () => setTimeout(updateMask, 200));
  if (window.ResizeObserver) {
    const ro = new ResizeObserver(()=> updateMask());
    ro.observe(frame);
  }

  // initialize
  await startCamera(currentFacing);

  // ensure mask + scanning start after loaded metadata
  video.addEventListener("loadedmetadata", ()=> {
    setTimeout(()=> {
      updateMask();
      startScanning();
    }, 120);
  });

})();
</script>
</body>
</html>
'
style="display:none; position:absolute; inset:0; width:100%; height:100%; border:none; z-index:9999;"
allow="camera">
</iframe>

</body>
</html>
